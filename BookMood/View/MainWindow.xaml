<Window x:Class="BookMood.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:BookMood"
        xmlns:conv="clr-namespace:BookMood.Converters"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="BookMood" Height="600" Width="800"
        Style="{StaticResource MaterialDesignWindow}">
    
    <Window.Resources>
        <conv:IndexToBrushConverter x:Key="IndexToBrushConverter"/>
        <conv:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <conv:BoolToTextConverter x:Key="BoolToTextConverter" />
    </Window.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="3.5*"/>
            <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!--Панель кнопок-->
        <StackPanel Orientation="Horizontal" Margin="0, 0, 0, 10">
            <Button Content="Загрузить" Command="{Binding LoadCommand}" Margin="0, 0, 5, 0"/>
            <Button Content="Сохранить" Command="{Binding SaveCommand}" Margin="0, 0, 5, 0"/>
            <Button Content="Добавить" Command="{Binding AddCommand}" Margin="0, 0, 5, 0"/>
            <Button Content="Удалить" Command="{Binding DeleteCommand}" Margin="0, 0, 5, 0"/>
        </StackPanel>

        <!--Список книг-->
        <ListBox Grid.Row="1" Grid.Column="0"
                 ItemsSource="{Binding Books}"
                 SelectedItem="{Binding SelectedBook, Mode=TwoWay}"
                 HorizontalAlignment="Stretch"
                 VerticalAlignment="Stretch"
                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                 BorderThickness="0"
                 Background="Transparent">

            <ListBox.ItemContainerStyle>
                <Style TargetType="ListBoxItem">
                    <Setter Property="Background">
                        <Setter.Value>
                            <MultiBinding Converter="{StaticResource IndexToBrushConverter}">
                                <Binding Source="{StaticResource BookColors}"/>
                            </MultiBinding>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Margin" Value="5"/>
                </Style>
            </ListBox.ItemContainerStyle>

            <!--Располагает элементы горизонтально, и когда место заканчивается, создаётся новая строка. -->
            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <WrapPanel Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>

            <!-- Как будет выглядеть каждая книга -->
            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Width="60" Height="180" Margin="5"
                            CornerRadius="4"
                            Padding="5"
                            BorderBrush="Gray"
                            BorderThickness="1"
                            ClipToBounds="True">
                        <Grid>
                            <Grid.LayoutTransform>
                                <RotateTransform Angle="270"/>
                            </Grid.LayoutTransform>

                            <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                                <TextBlock Text="{Binding Title}" 
                                            FontWeight="Bold"
                                            FontSize="12"
                                            TextWrapping="NoWrap" 
                                            TextAlignment="Center"
                                            TextTrimming="CharacterEllipsis"
                                            Margin="0,0,0,3" />

                                <TextBlock Text="{Binding Author}" 
                                            FontStyle="Italic" 
                                            FontWeight="Bold"
                                            FontSize="10"
                                            TextWrapping="NoWrap"
                                            TextAlignment="Center"
                                            RenderTransformOrigin="0.5,0.5"
                                            TextTrimming="CharacterEllipsis">
                                </TextBlock>
                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>
        </ListBox>

        <!--Панель редактирования-->
        <Border Grid.Row="1" Grid.Column="1"
                Padding="20"
                CornerRadius="20"
                Margin="10,0,0,0"
                Visibility="{Binding SelectedBook, Converter={StaticResource NullToVisibilityConverter}}">
            <StackPanel>
                <TextBlock Text="Описание книги"
                           FontSize="18"
                           FontWeight="Bold"
                           Foreground="White"
                           Margin="0,0,0,10" />
                <TextBox Text="{Binding SelectedBook.Title, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,5"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         materialDesign:HintAssist.Hint="Название" />
                <TextBox Text="{Binding SelectedBook.Author, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,5"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         materialDesign:HintAssist.Hint="Автор" />
                <TextBox Text="{Binding SelectedBook.Description}"
                         Margin="0,5"
                         FontSize="10"
                         TextWrapping="Wrap"
                         materialDesign:HintAssist.Hint="Описание">
                    <TextBox.Style>
                        <Style TargetType="TextBox" BasedOn="{StaticResource MaterialDesignOutlinedTextBox}">
                            <Setter Property="MaxHeight" Value="57" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsExpanded}" Value="True">
                                    <Setter Property="MaxHeight" Value="300" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBox.Style>
                </TextBox>
                <Button x:Name="ExpandButton"
                        Content="{Binding IsExpanded, Converter={StaticResource BoolToTextConverter}, ConverterParameter = 'cвернуть|развернуть'}"
                        Command="{Binding ToggleExpandCommand}"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Bottom"
                        FontSize="9"
                        MinWidth="50"
                        Height="20"
                        Background="Transparent"
                        BorderBrush="Transparent"/>
                <TextBox Text="{Binding SelectedBook.DateAdded, StringFormat='{}{0:dd.MM.yyyy HH:mm}', Mode=OneWay}"
                         Margin="0,5"
                         Style="{StaticResource MaterialDesignOutlinedTextBox}"
                         materialDesign:HintAssist.Hint="Дата добавления"
                         IsReadOnly="True"
                         IsTabStop="False">
                </TextBox>
            </StackPanel>
        </Border>
    </Grid>
</Window>
